----------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  W:\C6_Fang\WMH\Projects\Yihui\Sexdiff_suicide\output/Table1.log
  log type:  text
 opened on:  25 Dec 2024, 21:30:12

. 
. * Import data
. use "data/data1.dta", clear

. append using "data/data2.dta" "data/data3.dta", generate(newv)
(label cal already defined)
(label agec already defined)
(label agec already defined)
(label cal already defined)

. gen prd=newv+1

. drop newv

. 
. 
. * sum up events and person-time
. collapse (sum) _d fu, by(prd far agec cal edu fland marr income firstpreg psy sui_his)

. 
. gen py=round(fu/365.25)

. drop fu

. 
. 
. * calculate total PY by sex
. qui: sum py if far==0

. scalar m = r(sum)

. 
. qui: sum py if far==1

. scalar f = r(sum)

. 
. matrix X = J(1,6,.)

. 
. matrix X[1,1] = 0

. matrix X[1,2] = 0

. matrix X[1,3] = m

. matrix X[1,5] = f

. 
. 
. 
. * calculate N, PY and IR by categorical covars
. foreach i of num 1/9 {
  2. local j: word `i' of "agec" "cal" "edu" "fland" "marr" "income" "firstpreg" "psy" "sui_his"
  3. 
. * loop levels
. levelsof `j', local(lvl) 
  4. 
. foreach k of local lvl {
  5. 
.   matrix A = J(1,6,.)
  6.   
.   matrix A[1,1] = `i'
  7.   matrix A[1,2] = `k'
  8.   
. * mothers
.   qui: sum py if far==0  &  `j' == `k'
  9.   matrix A[1,3] = r(sum)
 10.   
. * fathers
.   qui: sum py if far==1  & `j' == `k'
 11.   matrix A[1,5] = r(sum)
 12.         
. * output
. matrix X = X\A
 13. }
 14. }
0 1 2 3 4 5
0 1 2 3
1 2 3 9
1 2 3 9
1 2
0 1 2 3 4 9
0 1
0 1 2
0 1

. 
. 
. matrix colnames X = var lvl py0 pct0 py1 pct1

. 
. clear

. svmat X, names(col)
number of observations will be reset to 34
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 34.

. save output/table1, replace
file output/table1.dta saved

. 
. *import data
. use output/table1,clear

. 
. *calculate percentage
. replace pct0=py0/m*100
(34 real changes made)

. replace pct1=py1/f*100
(34 real changes made)

. 
. *format 
. gen pym=string(py0,"%10.2gc")

. gen pctm=string(pct0,"%9.2f")

. 
. gen pyf=string(py1,"%10.2gc")

. gen pctf=string(pct1,"%9.2f")

. 
. 
. 
. * label
. label define varlab 0 "Total" 1 "agec" 2 "cal" 3 "edu" 4 "fland" 5 "marr" 6 "income" 7 "firstpreg" 8 "psy" 9 "sui_his"

. label values var varlab

. 
. keep var lvl pym pctm pyf pctf

. 
. 
. * output
. save output/table1, replace
file output/table1.dta saved

. export excel output/table1.xlsx, firstrow(var) replace
file output/table1.xlsx saved

. 
. log close
      name:  <unnamed>
       log:  W:\C6_Fang\WMH\Projects\Yihui\Sexdiff_suicide\output/Table1.log
  log type:  text
 closed on:  25 Dec 2024, 21:30:22
----------------------------------------------------------------------------------------------------------------------------------------------
